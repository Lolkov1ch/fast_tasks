{% extends 'base.html' %}
{% load static %}
{% block title %}Settings{% endblock %}

{% block content %}
<div class="settings-wrapper" style="max-width: 1200px; margin: 40px auto; padding: 0 20px;">
  <div style="display: flex; gap: 30px; flex-wrap: wrap;">
    <div class="tabs-sidebar" style="min-width: 220px; flex-shrink: 0;">
      <div style="position: sticky; top: 100px;">
        <ul style="list-style: none; padding: 0; margin: 0;">
          <li style="margin-bottom: 8px;"><button class="tab-button active" data-tab="account">üîß Account</button></li>
          <li style="margin-bottom: 8px;"><button class="tab-button" data-tab="notifications">üîî Notifications</button></li>
          <li style="margin-bottom: 8px;"><button class="tab-button" data-tab="privacy">üîí Privacy</button></li>
          <li style="margin-bottom: 8px;"><button class="tab-button" data-tab="site">üé® Site Settings</button></li>
        </ul>
      </div>
    </div>
    <div class="tab-contents" style="flex: 1; min-width: 0;">
      <div class="tab-content active" id="account">
        <div class="settings-card">
          <div class="card-header">
            <h2>Account Settings</h2>
            <p class="card-subtitle">Manage your account information and profile</p>
          </div>
          <div class="card-body">
            <form method="post" enctype="multipart/form-data">
              {% csrf_token %}
              <fieldset class="form-section">
                <legend class="section-legend">Account Info</legend>
                <div class="custom-form-fields">
                  {{ u_form.as_p }}
                </div>
              </fieldset>
              <fieldset class="form-section">
                <legend class="section-legend">Profile</legend>
                <div class="custom-form-fields">
                  <div class="avatar-preview-section">
                    <label>Avatar</label>
                    <div class="avatar-preview-container" id="avatarContainer">
                      <img id="avatarPreview" 
                           src="{% if user.profile.avatar %}{{ user.profile.avatar.url }}{% else %}https://ui-avatars.com/api/?name={% if user.first_name %}{{ user.first_name }}{% else %}{{ user.username }}{% endif %}&background=ce9b01ff&color=fff&size=150{% endif %}" 
                           alt="Avatar Preview" 
                           class="avatar-preview-img">
                      <div class="avatar-overlay">
                        <span>üì∑</span>
                        <span class="upload-text">Click to upload</span>
                      </div>
                    </div>
                    <input type="file" 
                           name="avatar" 
                           id="id_avatar" 
                           accept="image/*"
                           style="display: none;">
                    {% if p_form.avatar.errors %}
                      <ul class="errorlist">
                        {% for error in p_form.avatar.errors %}
                          <li>{{ error }}</li>
                        {% endfor %}
                      </ul>
                    {% endif %}
                    {% if user.profile.avatar %}
                      <div class="delete-avatar-section">
                        <button type="button" id="deleteAvatarBtn" class="btn-delete-avatar">
                          üóëÔ∏è Delete Avatar
                        </button>
                        <input type="checkbox" name="avatar-clear" id="avatar-clear" style="display: none;">
                      </div>
                    {% endif %}
                  </div>
                  {% for field in p_form %}
                    {% if field.name != 'avatar' %}
                      <p>
                        {{ field.label_tag }}
                        {{ field }}
                        {% if field.help_text %}
                          <span class="helptext">{{ field.help_text }}</span>
                        {% endif %}
                        {% if field.errors %}
                          <ul class="errorlist">
                            {% for error in field.errors %}
                              <li>{{ error }}</li>
                            {% endfor %}
                          </ul>
                        {% endif %}
                      </p>
                    {% endif %}
                  {% endfor %}
                </div>
              </fieldset>
              <button type="submit" class="btn-save">üíæ Save Changes</button>
            </form>
            <div style="margin-top: 40px; padding-top: 30px; border-top: 2px dashed #dee2e6;">
              <h4 style="color: #dc3545; margin-bottom: 12px; font-size: 1.1rem;">Danger Zone</h4>
              <p style="color: #6c757d; margin-bottom: 16px; font-size: 0.95rem;">Once you delete your account, there is no going back. Please be certain.</p>
              <a href="{% url 'tasks_app:delete_account' %}" class="btn-delete">üóëÔ∏è Delete Account</a>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-content" id="notifications">
        <div class="settings-card">
          <div class="card-header">
            <h2>Notifications Settings</h2>
            <p class="card-subtitle">Customize how and where you see notifications</p>
          </div>
          <div class="card-body">
            <form id="notification-settings-form">
              <fieldset class="form-section">
                <legend class="section-legend">Toast Notifications</legend>
                <label class="checkbox-label">
                  <input type="checkbox" id="enable_toasts" checked>
                  <span class="checkbox-text">Enable Toast Notifications</span>
                </label>
                <p class="help-text">Show popup notifications for important events</p>
              </fieldset>
              
              <fieldset class="form-section">
                <legend class="section-legend">Display Settings</legend>
                <div class="form-group">
                  <label for="toast_position" class="form-label">Position:</label>
                  <select id="toast_position" class="form-select">
                    <option value="top-right">Top Right</option>
                    <option value="top-left">Top Left</option>
                    <option value="bottom-right">Bottom Right</option>
                    <option value="bottom-left">Bottom Left</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="toast_duration" class="form-label">Duration (ms):</label>
                  <input type="number" id="toast_duration" value="5000" min="1000" step="100" class="form-input">
                  <p class="help-text">How long notifications stay visible (1000ms = 1 second)</p>
                </div>
              </fieldset>
              
              <button type="submit" class="btn-save">üíæ Save Notification Settings</button>
            </form>
            
            <div class="action-buttons">
              <button id="test-toast" class="btn-secondary">üß™ Test Toast</button>
              <button id="reset-settings" class="btn-delete">‚Üª Reset to Defaults</button>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-content" id="privacy">
        <div class="settings-card">
          <div class="card-header">
            <h2>Privacy Settings</h2>
            <p class="card-subtitle">Control your privacy and profile visibility</p>
          </div>
          <div class="card-body">
            <form method="post">
              {% csrf_token %}
              <fieldset class="form-section">
                <legend class="section-legend">Profile Visibility</legend>
                <label class="checkbox-label">
                  <input type="checkbox" id="profile_closed" name="profile_closed" {% if user.profile.is_closed %}checked{% endif %}>
                  <span class="checkbox-text">Close My Profile</span>
                </label>
                <div class="info-box">
                  <div class="info-icon">‚ÑπÔ∏è</div>
                  <div class="info-content">
                    <strong>What does this mean?</strong>
                    <p>When enabled, your profile will not be visible to other users. You will still be able to view your own profile and use all features normally.</p>
                  </div>
                </div>
              </fieldset>
              <button type="submit" name="update_privacy" class="btn-save">üíæ Save Privacy Settings</button>
            </form>
          </div>
        </div>
      </div>

      <div class="tab-content" id="site">
        <div class="settings-card">
          <div class="card-header">
            <h2>Site Settings</h2>
            <p class="card-subtitle">Customize your visual experience</p>
          </div>
          <div class="card-body">
            <form id="site-settings-form">
              <fieldset class="form-section">
                <legend class="section-legend">Visual Effects</legend>
                <label class="checkbox-label">
                  <input type="checkbox" id="enable_gradient" checked>
                  <span class="checkbox-text">Enable Animated Background Gradient</span>
                </label>
                <div class="info-box">
                  <div class="info-icon">‚ú®</div>
                  <div class="info-content">
                    <p>Toggle the animated gradient background effect throughout the site. Disabling this may improve performance on older devices.</p>
                  </div>
                </div>
              </fieldset>
              <button type="submit" class="btn-save">üíæ Save Site Settings</button>
            </form>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<style>
.settings-wrapper {
  position: relative;
  z-index: 1;
}

.tabs-sidebar ul {
  background: white;
  border-radius: 16px;
  padding: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

[data-bs-theme="dark"] .tabs-sidebar ul {
  background: #2d2d2d;
}

.tab-button {
  width: 100%;
  padding: 14px 18px;
  border: none;
  background: transparent;
  text-align: left;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  border-radius: 10px;
  transition: all 0.3s ease;
  color: #495057;
  display: flex;
  align-items: center;
  gap: 10px;
}

[data-bs-theme="dark"] .tab-button {
  color: #ced4da;
}

.tab-button:hover { 
  background: linear-gradient(135deg, rgba(255,87,34,0.1) 0%, rgba(206,155,1,0.1) 100%);
  transform: translateX(4px);
}

.tab-button.active { 
  background: linear-gradient(135deg, #FF5722 0%, #ce9b01ff 100%);
  color: white;
  box-shadow: 0 4px 12px rgba(255,87,34,0.3);
}

.tab-content { 
  display: none; 
  animation: fadeIn 0.4s ease;
}

.tab-content.active { 
  display: block; 
}

@keyframes fadeIn { 
  from { 
    opacity: 0; 
    transform: translateY(10px); 
  } 
  to { 
    opacity: 1; 
    transform: translateY(0); 
  } 
}

.settings-card {
  background: white;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 10px 40px rgba(0,0,0,0.12);
  position: relative;
  transition: all 0.3s ease;
}

[data-bs-theme="dark"] .settings-card {
  background: #2d2d2d;
}

.settings-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #FF5722 0%, #FFC107 50%, #ce9b01ff 100%);
  z-index: 10;
}

.card-header {
  background: linear-gradient(135deg, #FF5722 0%, #ce9b01ff 100%);
  color: white;
  padding: 2rem 2.5rem;
}

.card-header h2 {
  margin: 0 0 8px 0;
  font-size: 1.875rem;
  font-weight: 700;
}

.card-subtitle {
  margin: 0;
  opacity: 0.95;
  font-size: 1rem;
  font-weight: 400;
}

.card-body {
  padding: 2.5rem;
}

.form-section {
  border: 2px solid #e9ecef;
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  background: #f8f9fa;
  transition: all 0.3s ease;
}

[data-bs-theme="dark"] .form-section {
  background: #1a1a1a;
  border-color: #495057;
}

.form-section:hover {
  border-color: #FF5722;
  box-shadow: 0 4px 12px rgba(255,87,34,0.1);
}

.section-legend {
  font-size: 1.125rem;
  font-weight: 700;
  color: #FF5722;
  padding: 0 12px;
  margin-bottom: 1rem;
  background: white;
  border-radius: 20px;
  display: inline-block;
}

[data-bs-theme="dark"] .section-legend {
  color: #ce9b01ff;
  background: #2d2d2d;
}

.form-group {
  margin-bottom: 1.25rem;
}

.form-label {
  display: block;
  font-weight: 600;
  color: #495057;
  margin-bottom: 8px;
  font-size: 0.95rem;
}

[data-bs-theme="dark"] .form-label {
  color: #ced4da;
}

.form-input, .form-select { 
  width: 100%; 
  padding: 12px 16px; 
  border-radius: 10px; 
  border: 2px solid #dee2e6; 
  font-size: 15px;
  transition: all 0.3s ease;
  background: white;
  color: #212529;
}

[data-bs-theme="dark"] .form-input,
[data-bs-theme="dark"] .form-select {
  background: #343a40;
  border-color: #495057;
  color: #e9ecef;
}

.form-input:focus, .form-select:focus {
  outline: none;
  border-color: #FF5722;
  box-shadow: 0 0 0 4px rgba(255,87,34,0.15);
}

.checkbox-label {
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  padding: 12px;
  border-radius: 8px;
  transition: background 0.2s;
}

.checkbox-label:hover {
  background: rgba(255,87,34,0.05);
}

.checkbox-label input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
  accent-color: #FF5722;
}

.checkbox-text {
  font-weight: 600;
  font-size: 1rem;
  color: #212529;
}

[data-bs-theme="dark"] .checkbox-text {
  color: #e9ecef;
}

.help-text {
  margin: 8px 0 0 0;
  font-size: 0.875rem;
  color: #6c757d;
  line-height: 1.5;
}

[data-bs-theme="dark"] .help-text {
  color: #adb5bd;
}

.info-box {
  display: flex;
  gap: 12px;
  background: linear-gradient(135deg, #e3f2fd 0%, #fff3e0 100%);
  padding: 16px;
  border-radius: 12px;
  border-left: 4px solid #FF5722;
  margin-top: 16px;
}

[data-bs-theme="dark"] .info-box {
  background: linear-gradient(135deg, #1a237e 0%, #e65100 100%);
  background: rgba(255,87,34,0.1);
  border-left-color: #ce9b01ff;
}

.info-icon {
  font-size: 1.5rem;
  flex-shrink: 0;
}

.info-content {
  flex: 1;
}

.info-content strong {
  display: block;
  color: #FF5722;
  margin-bottom: 4px;
  font-size: 0.95rem;
}

[data-bs-theme="dark"] .info-content strong {
  color: #ce9b01ff;
}

.info-content p {
  margin: 0;
  font-size: 0.875rem;
  color: #495057;
  line-height: 1.5;
}

[data-bs-theme="dark"] .info-content p {
  color: #ced4da;
}

.btn-save {
  background: linear-gradient(135deg, #FF5722 0%, #FFC107 100%);
  border: none;
  color: white;
  padding: 14px 32px;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  font-size: 1rem;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(255,87,34,0.3);
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-save:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255,87,34,0.5);
}

.btn-secondary {
  background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
  border: none;
  color: white;
  padding: 12px 28px;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  font-size: 0.95rem;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(108,117,125,0.3);
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-secondary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(108,117,125,0.5);
}

.btn-delete {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 28px;
  background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
  color: white;
  text-decoration: none;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.95rem;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(220,53,69,0.3);
}

.btn-delete:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(220,53,69,0.5);
  text-decoration: none;
  color: white;
}

.action-buttons {
  display: flex;
  gap: 12px;
  margin-top: 30px;
  padding-top: 24px;
  border-top: 2px dashed #dee2e6;
  flex-wrap: wrap;
}

[data-bs-theme="dark"] .action-buttons {
  border-top-color: #495057;
}

.custom-form-fields p {
  margin-bottom: 1.5rem;
}

.custom-form-fields label {
  display: block;
  font-weight: 600;
  color: #495057;
  margin-bottom: 10px;
  font-size: 0.95rem;
  letter-spacing: 0.3px;
}

[data-bs-theme="dark"] .custom-form-fields label {
  color: #ced4da;
}

.custom-form-fields input[type="text"],
.custom-form-fields input[type="email"],
.custom-form-fields input[type="file"],
.custom-form-fields textarea,
.custom-form-fields select {
  width: 100%;
  padding: 14px 18px;
  border: 2px solid #dee2e6;
  border-radius: 12px;
  font-size: 15px;
  font-family: inherit;
  transition: all 0.3s ease;
  background: white;
  color: #212529;
}

[data-bs-theme="dark"] .custom-form-fields input[type="text"],
[data-bs-theme="dark"] .custom-form-fields input[type="email"],
[data-bs-theme="dark"] .custom-form-fields input[type="file"],
[data-bs-theme="dark"] .custom-form-fields textarea,
[data-bs-theme="dark"] .custom-form-fields select {
  background: #343a40;
  border-color: #495057;
  color: #e9ecef;
}

.custom-form-fields input[type="text"]:focus,
.custom-form-fields input[type="email"]:focus,
.custom-form-fields textarea:focus,
.custom-form-fields select:focus {
  outline: none;
  border-color: #FF5722;
  box-shadow: 0 0 0 4px rgba(255,87,34,0.15);
  transform: translateY(-2px);
}

.custom-form-fields textarea {
  min-height: 120px;
  resize: vertical;
  line-height: 1.6;
}

.custom-form-fields input[type="file"] {
  padding: 12px;
  cursor: pointer;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-style: dashed;
}

[data-bs-theme="dark"] .custom-form-fields input[type="file"] {
  background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
}

.custom-form-fields input[type="file"]:hover {
  border-color: #FF5722;
  background: linear-gradient(135deg, rgba(255,87,34,0.05) 0%, rgba(206,155,1,0.05) 100%);
}

.custom-form-fields .helptext {
  display: block;
  margin-top: 6px;
  font-size: 0.85rem;
  color: #6c757d;
  font-style: italic;
}

[data-bs-theme="dark"] .custom-form-fields .helptext {
  color: #adb5bd;
}

.custom-form-fields .errorlist {
  list-style: none;
  padding: 0;
  margin: 8px 0 0 0;
}

.custom-form-fields .errorlist li {
  background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
  color: white;
  padding: 8px 12px;
  border-radius: 8px;
  font-size: 0.875rem;
  margin-bottom: 4px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.custom-form-fields .errorlist li::before {
  content: '‚ö†Ô∏è';
}

.custom-form-fields a {
  display: none !important;
}

.custom-form-fields p:has(a) {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.custom-form-fields p:has(a)::before {
  content: none;
}

.custom-form-fields br {
  display: none;
}

.avatar-upload-wrapper {
  margin-bottom: 1.5rem;
}

.avatar-upload-wrapper > label {
  display: block;
  font-weight: 600;
  color: #495057;
  margin-bottom: 10px;
  font-size: 0.95rem;
  letter-spacing: 0.3px;
}

[data-bs-theme="dark"] .avatar-upload-wrapper > label {
  color: #ced4da;
}

.avatar-upload-wrapper input[type="file"] {
  width: 100%;
  padding: 12px;
  cursor: pointer;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border: 2px dashed #dee2e6;
  border-radius: 12px;
  font-size: 15px;
  transition: all 0.3s ease;
}

[data-bs-theme="dark"] .avatar-upload-wrapper input[type="file"] {
  background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
  border-color: #495057;
  color: #e9ecef;
}

.avatar-upload-wrapper input[type="file"]:hover {
  border-color: #FF5722;
  background: linear-gradient(135deg, rgba(255,87,34,0.05) 0%, rgba(206,155,1,0.05) 100%);
}

.avatar-upload-wrapper {
  margin-bottom: 1.5rem;
}

.avatar-upload-wrapper > label {
  display: block;
  font-weight: 600;
  color: #495057;
  margin-bottom: 10px;
  font-size: 0.95rem;
  letter-spacing: 0.3px;
}

[data-bs-theme="dark"] .avatar-upload-wrapper > label {
  color: #ced4da;
}

.avatar-upload-wrapper input[type="file"] {
  width: 100%;
  padding: 12px;
  cursor: pointer;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border: 2px dashed #dee2e6;
  border-radius: 12px;
  font-size: 15px;
  transition: all 0.3s ease;
}

[data-bs-theme="dark"] .avatar-upload-wrapper input[type="file"] {
  background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
  border-color: #495057;
  color: #e9ecef;
}

.avatar-upload-wrapper input[type="file"]:hover {
  border-color: #FF5722;
  background: linear-gradient(135deg, rgba(255,87,34,0.05) 0%, rgba(206,155,1,0.05) 100%);
}

.delete-avatar-section {
  margin-top: 12px;
}

.btn-delete-avatar {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  box-shadow: 0 3px 10px rgba(220,53,69,0.3);
}

.btn-delete-avatar:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 16px rgba(220,53,69,0.5);
}

.btn-delete-avatar.active {
  background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
  box-shadow: 0 3px 10px rgba(108,117,125,0.3);
}

.btn-delete-avatar.active::before {
  content: '‚Üª ';
}

.custom-form-fields input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
  accent-color: #FF5722;
  margin-right: 8px;
}

.avatar-preview-section {
  margin-bottom: 1.5rem;
}

.avatar-preview-section label {
  display: block;
  font-weight: 600;
  color: #495057;
  margin-bottom: 12px;
  font-size: 0.95rem;
  letter-spacing: 0.3px;
}

[data-bs-theme="dark"] .avatar-preview-section label {
  color: #ced4da;
}

.avatar-preview-container {
  position: relative;
  width: 150px;
  height: 150px;
  border-radius: 50%;
  overflow: hidden;
  border: 4px solid #FF5722;
  box-shadow: 0 8px 24px rgba(255,87,34,0.3);
  transition: all 0.3s ease;
  background: white;
  cursor: pointer;
}

[data-bs-theme="dark"] .avatar-preview-container {
  border-color: #ce9b01ff;
  box-shadow: 0 8px 24px rgba(206,155,1,0.3);
  background: #2d2d2d;
}

.avatar-preview-container:hover {
  transform: scale(1.05);
  box-shadow: 0 12px 32px rgba(255,87,34,0.4);
}

[data-bs-theme="dark"] .avatar-preview-container:hover {
  box-shadow: 0 12px 32px rgba(206,155,1,0.4);
}

.avatar-preview-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.avatar-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, rgba(255,87,34,0.9) 0%, rgba(206,155,1,0.9) 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
  opacity: 0;
  transition: opacity 0.3s ease;
  font-size: 2.5rem;
}

.avatar-overlay .upload-text {
  font-size: 0.875rem;
  font-weight: 600;
  color: white;
  text-align: center;
  padding: 0 10px;
}

.avatar-preview-container:hover .avatar-overlay {
  opacity: 1;
}

body.no-gradient::before {
  background: #f5f5f5 !important;
  animation: none !important;
}

[data-bs-theme="dark"] body.no-gradient::before {
  background: #121212 !important;
  animation: none !important;
}

@keyframes toastProgress {
  from { width: 100%; }
  to { width: 0%; }
}

.toast-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 4px;
  background: currentColor;
  opacity: 0.3;
  animation: toastProgress linear forwards;
}

@media (max-width: 768px) {
  .settings-wrapper > div {
    flex-direction: column;
  }
  
  .tabs-sidebar {
    width: 100%;
  }
  
  .tabs-sidebar > div {
    position: static !important;
  }
  
  .tabs-sidebar ul {
    display: flex;
    overflow-x: auto;
    gap: 8px;
    padding: 8px;
  }
  
  .tabs-sidebar li {
    margin-bottom: 0 !important;
  }
  
  .tab-button {
    white-space: nowrap;
    min-width: fit-content;
  }
  
  .card-header {
    padding: 1.5rem;
  }
  
  .card-body {
    padding: 1.5rem;
  }
  
  .card-header h2 {
    font-size: 1.5rem;
  }
  
  .action-buttons {
    flex-direction: column;
  }
  
  .action-buttons button {
    width: 100%;
    justify-content: center;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const tabButtons = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.dataset.tab;
      tabButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      tabContents.forEach(c => {
        c.classList.remove('active');
        if(c.id === target) c.classList.add('active');
      });
    });
  });

  const defaultSettings = {
    enableToasts: true,
    toastPosition: 'top-right',
    toastDuration: 5000
  };

  function loadSettings() {
    const saved = localStorage.getItem('toastSettings');
    return saved ? JSON.parse(saved) : defaultSettings;
  }

  function saveSettings(settings) {
    localStorage.setItem('toastSettings', JSON.stringify(settings));
  }
  let settings = loadSettings();
  document.getElementById('enable_toasts').checked = settings.enableToasts;
  document.getElementById('toast_position').value = settings.toastPosition;
  document.getElementById('toast_duration').value = settings.toastDuration;

  const form = document.getElementById('notification-settings-form');
  form.addEventListener('submit', e => {
    e.preventDefault();
    settings = {
      enableToasts: document.getElementById('enable_toasts').checked,
      toastPosition: document.getElementById('toast_position').value,
      toastDuration: parseInt(document.getElementById('toast_duration').value)
    };
    saveSettings(settings);

    if (window.updateToastSettings) {
      window.updateToastSettings(settings);
    }
    
    window.showToast('Notification settings saved!', 'success');
  });
  document.getElementById('test-toast').addEventListener('click', () => {
    window.showToast('This is a test toast notification!', 'info');
  });

  document.getElementById('reset-settings').addEventListener('click', () => {
    settings = defaultSettings;
    saveSettings(settings);
    document.getElementById('enable_toasts').checked = settings.enableToasts;
    document.getElementById('toast_position').value = settings.toastPosition;
    document.getElementById('toast_duration').value = settings.toastDuration;

    if (window.updateToastSettings) {
      window.updateToastSettings(settings);
    }
    
    window.showToast('Settings reset to defaults', 'success');
  });

  function showToastWithSettings(message, type = 'info') {
    if (!settings.enableToasts) return;

    const toastContainer = document.getElementById('toastContainer');
    const icons = { 
      success: '‚úì', 
      error: '‚úï', 
      danger: '‚úï', 
      info: '‚Ñπ', 
      warning: '‚ö†' 
    };

    const toast = document.createElement('div');
    toast.className = `custom-toast toast-${type}`;
    toast.dataset.duration = settings.toastDuration;

    toast.innerHTML = `
      <div class="toast-content">
        <div class="toast-icon">${icons[type] || '‚Ñπ'}</div>
        <div class="toast-message">${message}</div>
        <button class="toast-close" aria-label="Close">√ó</button>
      </div>
      <div class="toast-progress"></div>
    `;

    toastContainer.style.top = 'auto';
    toastContainer.style.bottom = 'auto';
    toastContainer.style.left = 'auto';
    toastContainer.style.right = 'auto';

    switch(settings.toastPosition) {
      case 'top-right':
        toastContainer.style.top = '80px';
        toastContainer.style.right = '20px';
        toastContainer.style.alignItems = 'flex-end';
        toastContainer.style.flexDirection = 'column';
        break;
      case 'top-left':
        toastContainer.style.top = '80px';
        toastContainer.style.left = '20px';
        toastContainer.style.alignItems = 'flex-start';
        toastContainer.style.flexDirection = 'column';
        break;
      case 'bottom-right':
        toastContainer.style.bottom = '20px';
        toastContainer.style.right = '20px';
        toastContainer.style.alignItems = 'flex-end';
        toastContainer.style.flexDirection = 'column-reverse';
        break;
      case 'bottom-left':
        toastContainer.style.bottom = '20px';
        toastContainer.style.left = '20px';
        toastContainer.style.alignItems = 'flex-start';
        toastContainer.style.flexDirection = 'column-reverse';
        break;
    }

    toastContainer.appendChild(toast);

    const progressBar = toast.querySelector('.toast-progress');
    if (progressBar) {
      progressBar.style.animationDuration = `${settings.toastDuration}ms`;
    }

    const timeoutId = setTimeout(() => {
      toast.classList.add('hiding');
      setTimeout(() => toast.remove(), 400);
    }, settings.toastDuration);

    const closeBtn = toast.querySelector('.toast-close');
    closeBtn.addEventListener('click', () => {
      clearTimeout(timeoutId);
      toast.classList.add('hiding');
      setTimeout(() => toast.remove(), 400);
    });
  }

  window.showToast = function(message, type = 'info', duration = null) {
    if (duration !== null) {
      const tempSettings = { ...settings, toastDuration: duration };
      const originalSettings = settings;
      settings = tempSettings;
      showToastWithSettings(message, type);
      settings = originalSettings;
    } else {
      showToastWithSettings(message, type);
    }
  };

  const gradientCheckbox = document.getElementById('enable_gradient');

  function loadGradientSetting() {
    const enabled = localStorage.getItem('gradientEnabled');
    return enabled === null ? true : enabled === 'true';
  }

  const gradientEnabled = loadGradientSetting();
  gradientCheckbox.checked = gradientEnabled;

  const siteForm = document.getElementById('site-settings-form');
  siteForm.addEventListener('submit', e => {
    e.preventDefault();
    const enabled = gradientCheckbox.checked;
    localStorage.setItem('gradientEnabled', enabled);
    
    if (window.updateGradientSetting) {
      window.updateGradientSetting(enabled);
    } else {
      if (enabled) {
        document.body.classList.remove('no-gradient');
      } else {
        document.body.classList.add('no-gradient');
      }
    }
    
    window.showToast('Site settings saved!', 'success');
  });

  const avatarContainer = document.getElementById('avatarContainer');
  const fileInput = document.getElementById('id_avatar');
  const avatarPreview = document.getElementById('avatarPreview');
  
  if (avatarContainer && fileInput && avatarPreview) {
    avatarContainer.addEventListener('click', function() {
      fileInput.click();
    });
    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          avatarPreview.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });
  }

  const deleteAvatarBtn = document.getElementById('deleteAvatarBtn');
  const deleteAvatarCheckbox = document.getElementById('avatar-clear');
  
  if (deleteAvatarBtn && deleteAvatarCheckbox) {
    deleteAvatarBtn.addEventListener('click', function() {
      if (deleteAvatarCheckbox.checked) {
        deleteAvatarCheckbox.checked = false;
        deleteAvatarBtn.classList.remove('active');
        deleteAvatarBtn.textContent = 'üóëÔ∏è Delete Avatar';
      } else {
        deleteAvatarCheckbox.checked = true;
        deleteAvatarBtn.classList.add('active');
        deleteAvatarBtn.textContent = 'Undo Delete';
      }
    });
  }
});
</script>

{% endblock %}