{% extends 'base.html' %}
{% load static %}
{% block content %}

<style>
  .fade-in {
    opacity: 0;
    transform: translateY(10px);
    animation: fadeInUp 0.5s forwards;
  }
  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .card-hover {
    transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
    cursor: pointer;
    background-color: var(--bs-body-bg);
    position: relative;
  }
  .card-hover:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: 0 15px 25px rgba(0,0,0,0.25);
    background-color: var(--bs-light);
  }
  @media (prefers-color-scheme: dark) {
    .card-hover:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
  }
  .task-thumbnails {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-bottom: 8px;
  }
  .task-thumbnails img {
    width: 48px;
    height: 48px;
    object-fit: cover;
    border-radius: 6px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .task-thumbnails img:hover {
    transform: scale(1.2);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }
  .card-hover .card-body {
    padding: 12px;
  }
  .card-hover .card-title {
    font-size: 1rem;
    margin-bottom: 6px;
  }
  .card-hover .card-text {
    font-size: 0.85rem;
    margin-bottom: 4px;
  }
  .card-hover .btn {
    transition: all 0.3s ease;
    position: relative;
    z-index: 10;
  }
  .card-hover .btn:hover {
    transform: translateY(-2px) scale(1.05);
  }
</style>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.card-hover');
    
    cards.forEach(card => {
      card.addEventListener('click', function(e) {
        if (e.target.closest('.btn')) {
          return;
        }
        const detailsUrl = this.dataset.detailsUrl;
        if (detailsUrl) {
          window.location.href = detailsUrl;
        }
      });
    });
  });
</script>

<h2 class="text-center mb-4">Available Tasks</h2>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
  {% for task in tasks %}
    <div class="col fade-in" style="animation-delay: {{ forloop.counter0|add:"0.05"|floatformat:2 }}s;">
      <div class="card h-100 shadow-sm border-0 rounded-3 card-hover" data-details-url="{% url 'tasks_app:task_detail' task.pk %}">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ task.title }}</h5>

          {% if task.image_set.all %}
            <div class="task-thumbnails">
              {% for img in task.image_set.all %}
                <img src="{{ img.image.url }}" alt="Attachment">
              {% endfor %}
            </div>
          {% endif %}

          <p class="card-text mb-1"><strong>Status:</strong> 
            <span class="badge 
              {% if task.status == 'pending' %}bg-warning
              {% elif task.status == 'in_progress' %}bg-primary
              {% elif task.status == 'completed' %}bg-success
              {% else %}bg-secondary{% endif %} rounded-pill">
              {{ task.get_status_display }}
            </span>
          </p>
          <p class="card-text mb-1"><strong>Priority:</strong> 
            <span class="badge 
              {% if task.priority == 'low' %}bg-info
              {% elif task.priority == 'medium' %}bg-primary
              {% elif task.priority == 'high' %}bg-danger
              {% else %}bg-secondary{% endif %} rounded-pill">
              {{ task.get_priority_display }}
            </span>
          </p>
          <p class="card-text mb-3"><strong>Due:</strong> 
            {% if task.due_date %}
              {{ task.due_date|date:"d.m.Y" }}
            {% else %}
              —
            {% endif %}
          </p>

          <div class="mt-auto d-flex flex-wrap gap-2">
            <a href="{% url 'tasks_app:task_detail' task.pk %}" class="btn btn-outline-primary btn-sm rounded-pill">Details</a>
            <a href="{% url 'tasks_app:task_update' task.pk %}" class="btn btn-outline-secondary btn-sm rounded-pill">Edit</a>
            <a href="{% url 'tasks_app:task_delete' task.pk %}" class="btn btn-outline-danger btn-sm rounded-pill">Delete</a>
          </div>
        </div>
      </div>
    </div>
  {% empty %}
<div class="d-flex justify-content-center align-items-center" style="min-height: 60vh; width: 100%;">
  <div class="alert alert-info text-center rounded-3 py-5 px-4" 
       style="font-size: 1.1rem; max-width: 500px; animation: fadeInUp 0.5s;">
    <div style="font-size: 3rem; margin-bottom: 12px;">⚡</div>
    <h4 class="mb-2">No tasks found</h4>
    <p class="mb-3 text-muted">
      You don't have any tasks yet. Start by creating a new task to keep track of work.
    </p>
    <a href="{% url 'tasks_app:task_create' %}" class="btn btn-primary rounded-pill px-4 py-2">
      Create First Task
    </a>
    <div style="margin-top: 12px; font-size: 0.9rem; color: #666;">
      Tip: Use the search or filters to find tasks quickly.
    </div>
  </div>
</div>
{% endfor %}
</div>
<div class="d-flex justify-content-center mt-4 gap-2">
  {% if tasks.has_previous %}
    <a href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}page={{ tasks.previous_page_number }}" class="btn btn-secondary rounded-pill">Back</a>
  {% endif %}
  {% if tasks.has_next %}
    <a href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}page={{ tasks.next_page_number }}" class="btn btn-secondary rounded-pill">Forward</a>
  {% endif %}
</div>

{% endblock %}